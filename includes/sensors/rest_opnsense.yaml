- authentication: basic
  verify_ssl: false
  username: !secret opns_key
  password: !secret opns_secret
  resource: https://opnsense.mcfly.net/api/wireguard/server/getServer/b007cda3-7d52-472e-96b9-f0b4a8bf4ff8
  sensor:
    - unique_id: airvpn_server
      name: AirVPN server
      value_template: >
        {% set data = namespace(servers = []) %}
        {% set peers = merge_response(value_json.server.peers) %}
        {% for peer in peers %}
          {% if peer.selected %}
            {% set data.servers = data.servers + [peer.value] %}
          {% endif %}
        {% endfor %}
        {% if data.servers %}
          {{ data.servers | join(' ') }}
        {% else %}
          Not connected
        {% endif %}
    - unique_id: wg0_peers
      name: wg0 peers
      json_attributes_path: '$.server'
      json_attributes:
        - 'peers'
      value_template: >
        {% set data = namespace(servers = []) %}
        {% set peers = merge_response(value_json.server.peers) %}
        {% for peer in peers %}
          {% set data.servers = data.servers + [peer.value] %}
        {% endfor %}
        {{ data.servers | join(', ') }}